<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>网络寻租</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="author" content="halida" />
    <link rel="alternate" type="application/rss+xml" title="网络寻租 - RSS" href="http://blog.linjunhalida.com/feed" />
    <link href="/stylesheets/pygments-default.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/jquery.js" type="text/javascript"></script>
  </head>
  <body class='color-4'>
    <div id='warper'>
      <nav>
        <div id='container'>
          <ul class='first-nav'>
            <li>
              <a href="/">网络寻租</a>
            </li>
            <li>
              <a href="/list.html">列表</a>
            </li>
            <li>
              <a href="/about.html">关于</a>
            </li>
          </ul>
          <ul class='secondary-nav'>
            <li>
              <a href="/feed.xml">feed</a>
            </li>
          </ul>
          <select id='color-select'>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
        </div>
      </nav>
      <div id='block-nav'></div>
      <div id='content'>
        <div class='article'>
          <g:plusone></g:plusone>
          <script type='text/javascript'>
            //<![CDATA[
              window.___gcfg = {lang: 'zh-CN'};
              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
            //]]>
          </script>
          <h1 class='article-title'>qml介绍</h1>
          <div class="document">
          <div class="section" id="qml">
          <h1>QML</h1>
          <p>今天去看Qt的最新进展, 发现: Qt 4.7 已于2010年九月份发布了, 里面带有一个全新的写GUI的方式: QML.</p>
          <p>具体相关的介绍, 在 <a class="reference external" href="http://doc.qt.nokia.com/4.7-snapshot/index.html">Qt4.7官方文档</a> 上面有 <a class="reference external" href="http://doc.qt.nokia.com/4.7-snapshot/qdeclarativeintroduction.html">QML介绍</a> . 我花了半个晚上的时间来学习 <a class="reference external" href="http://doc.qt.nokia.com/4.7-snapshot/qml-tutorial.html">QML的教程</a> , 发现真的不错.</p>
          <p>下面是 <a class="reference external" href="http://doc.qt.nokia.com/4.7-snapshot/qml-tutorial.html">QML的教程</a> 里面的内容, 我稍微介绍一下.</p>
          </div>
          <div class="section" id="id3">
          <h1>示例1</h1>
          <p>简单点说, QML就是以定义的方式来写界面, 格式很像CSS. 一个简单的示例代码:</p>
          <div class="highlight"><pre><span class="c1">//首先引入相关的模块</span>
          <span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">1.0</span>
          
          <span class="nx">Rectangle</span> <span class="p">{</span>
              <span class="nx">id</span><span class="o">:</span> <span class="nx">page</span>
              <span class="nx">width</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">200</span>
              <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;lightgray&quot;</span>
          
              <span class="nx">Text</span> <span class="p">{</span>
                  <span class="nx">id</span><span class="o">:</span> <span class="nx">helloText</span>
                  <span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;Hello world!&quot;</span>
                  <span class="nx">y</span><span class="o">:</span> <span class="mi">30</span>
                  <span class="nx">anchors</span><span class="p">.</span><span class="nx">horizontalCenter</span><span class="o">:</span> <span class="nx">page</span><span class="p">.</span><span class="nx">horizontalCenter</span>
                  <span class="nx">font</span><span class="p">.</span><span class="nx">pointSize</span><span class="o">:</span> <span class="mi">24</span><span class="p">;</span> <span class="nx">font</span><span class="p">.</span><span class="nx">bold</span><span class="o">:</span> <span class="kc">true</span>
              <span class="p">}</span>
          <span class="p">}</span>
          </pre></div>
          <p>这里面定义了一个Rectangle(其实就是方块啦)作为背景, 上面再加了一个Text. 注意, Text的位置是通过设定anchors的方法来定位的.</p>
          <p>显示的效果就是:</p>
          <img alt="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial1.png" src="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial1.png" />
          </div>
          <div class="section" id="id4">
          <h1>示例2</h1>
          <p>QML能够自己定义对象类型, 比如,新建一个文件Cell.qml:</p>
          <div class="highlight"><pre><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">1.0</span>
          
          <span class="nx">Item</span> <span class="p">{</span>
              <span class="nx">id</span><span class="o">:</span> <span class="nx">container</span>
              <span class="nx">property</span> <span class="nx">alias</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="nx">rectangle</span><span class="p">.</span><span class="nx">color</span>
              <span class="nx">signal</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">color</span> <span class="nx">cellColor</span><span class="p">)</span>
          
              <span class="nx">width</span><span class="o">:</span> <span class="mi">40</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">25</span>
          
              <span class="nx">Rectangle</span> <span class="p">{</span>
                  <span class="nx">id</span><span class="o">:</span> <span class="nx">rectangle</span>
                  <span class="nx">border</span><span class="p">.</span><span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;white&quot;</span>
                  <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span>
              <span class="p">}</span>
          
              <span class="nx">MouseArea</span> <span class="p">{</span>
                  <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span>
                  <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clicked</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">cellColor</span><span class="p">)</span>
              <span class="p">}</span>
          <span class="p">}</span>
          </pre></div>
          <p>这里面定义了一个Cell类型, 它里面有一个Rectangle, 以及一个MouseArea(后面再说).</p>
          <p>我们可以定义新的属性:</p>
          <div class="highlight"><pre><span class="nx">property</span> <span class="nx">alias</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="nx">rectangle</span><span class="p">.</span><span class="nx">color</span>
          </pre></div>
          <p>这个属性只是Rectangle颜色的别名.</p>
          <p>也可以定义新的事件:</p>
          <div class="highlight"><pre><span class="nx">signal</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">color</span> <span class="nx">cellColor</span><span class="p">)</span>
          </pre></div>
          <p>MouseArea是用来做用户交互的, 我们把它的onClicked事件和我们定义的clicked事件绑定起来:</p>
          <div class="highlight"><pre><span class="nx">MouseArea</span> <span class="p">{</span>
              <span class="p">...</span>
              <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clicked</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">cellColor</span><span class="p">)</span>
          <span class="p">}</span>
          </pre></div>
          <p>这样, 当用户点击Cell之后, 就会触发clicked事件, 这个事件附带Cell方块的颜色作为参数.</p>
          <p>我们定义了一个Cell之后, 如何使用呢? 这里是使用Cell的代码:</p>
          <div class="highlight"><pre><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">1.0</span>
          
          <span class="nx">Rectangle</span> <span class="p">{</span>
              <span class="nx">id</span><span class="o">:</span> <span class="nx">page</span>
              <span class="nx">width</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">200</span>
              <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;lightgray&quot;</span>
          
              <span class="nx">Text</span> <span class="p">{</span>
                  <span class="nx">id</span><span class="o">:</span> <span class="nx">helloText</span>
                  <span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;Hello world!&quot;</span>
                  <span class="nx">y</span><span class="o">:</span> <span class="mi">30</span>
                  <span class="nx">anchors</span><span class="p">.</span><span class="nx">horizontalCenter</span><span class="o">:</span> <span class="nx">page</span><span class="p">.</span><span class="nx">horizontalCenter</span>
                  <span class="nx">font</span><span class="p">.</span><span class="nx">pointSize</span><span class="o">:</span> <span class="mi">24</span><span class="p">;</span> <span class="nx">font</span><span class="p">.</span><span class="nx">bold</span><span class="o">:</span> <span class="kc">true</span>
              <span class="p">}</span>
          
              <span class="nx">Grid</span> <span class="p">{</span>
                  <span class="nx">id</span><span class="o">:</span> <span class="nx">colorPicker</span>
                  <span class="nx">x</span><span class="o">:</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">bottom</span><span class="o">:</span> <span class="nx">page</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">bottomMargin</span><span class="o">:</span> <span class="mi">4</span>
                  <span class="nx">rows</span><span class="o">:</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">columns</span><span class="o">:</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">spacing</span><span class="o">:</span> <span class="mi">3</span>
          
                  <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
                  <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
                  <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
                  <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
                  <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
                  <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
              <span class="p">}</span>
          <span class="p">}</span>
          </pre></div>
          <p>效果如下:</p>
          <img alt="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial2.png" src="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial2.png" />
          <p>别看上面那些代码那么多, 其实都是些图块的定义. 功能就是, 点击上面一堆Cell其中的一个, 就会改变Hello world的颜色. 如何做到的呢? 只要定义Cell的onClicked事件引发后, 对应执行的代码就好了:</p>
          <div class="highlight"><pre><span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
          </pre></div>
          </div>
          <div class="section" id="id5">
          <h1>示例3</h1>
          <p>QML最神奇的地方是, 能够定义效果, 比如实现这个:</p>
          <img alt="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial3_animation.gif" src="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial3_animation.gif" />
          <p>当鼠标点击hello world的时候, 就会出现上面的动画.</p>
          <p>核心代码是这个:</p>
          <div class="highlight"><pre><span class="nx">Text</span> <span class="p">{</span>
              <span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;Hello world!&quot;</span>
              <span class="p">...</span>
          
              <span class="nx">MouseArea</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span> <span class="p">}</span>
          
              <span class="nx">states</span><span class="o">:</span> <span class="nx">State</span> <span class="p">{</span>
                  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span> <span class="nx">when</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">.</span><span class="nx">pressed</span> <span class="o">==</span> <span class="kc">true</span>
                  <span class="nx">PropertyChanges</span> <span class="p">{</span> <span class="nx">target</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">;</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">160</span><span class="p">;</span> <span class="nx">rotation</span><span class="o">:</span> <span class="mi">180</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span> <span class="p">}</span>
              <span class="p">}</span>
          
              <span class="nx">transitions</span><span class="o">:</span> <span class="nx">Transition</span> <span class="p">{</span>
                  <span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span> <span class="nx">reversible</span><span class="o">:</span> <span class="kc">true</span>
                  <span class="nx">ParallelAnimation</span> <span class="p">{</span>
                      <span class="nx">NumberAnimation</span> <span class="p">{</span> <span class="nx">properties</span><span class="o">:</span> <span class="s2">&quot;y,rotation&quot;</span><span class="p">;</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">InOutQuad</span> <span class="p">}</span>
                      <span class="nx">ColorAnimation</span> <span class="p">{</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
                  <span class="p">}</span>
              <span class="p">}</span>
          <span class="p">}</span>
          </pre></div>
          <p>先定义一个MouseArea, 捕捉用户点击的事件</p>
          <div class="highlight"><pre><span class="nx">MouseArea</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span> <span class="p">}</span>
          </pre></div>
          <p>然后定义一个Hello world翻转的状态, 当mouseArea被点击的时候, 就会把自己变成翻转的状态.</p>
          <div class="highlight"><pre><span class="nx">states</span><span class="o">:</span> <span class="nx">State</span> <span class="p">{</span>
              <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span> <span class="nx">when</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">.</span><span class="nx">pressed</span> <span class="o">==</span> <span class="kc">true</span>
              <span class="nx">PropertyChanges</span> <span class="p">{</span> <span class="nx">target</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">;</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">160</span><span class="p">;</span> <span class="nx">rotation</span><span class="o">:</span> <span class="mi">180</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span> <span class="p">}</span>
          <span class="p">}</span>
          </pre></div>
          <p>当然, 现在的话点击之后, 就会立刻把hello world翻转过来, 我们要定义一个效果</p>
          <div class="highlight"><pre><span class="nx">transitions</span><span class="o">:</span> <span class="nx">Transition</span> <span class="p">{</span>
              <span class="c1">// 这个效果是为从初始状态变为down状态而设定的</span>
              <span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span>
          
              <span class="c1">// 并且这个效果是双向的, down变回初始状态也会反过来执行这样的效果.</span>
              <span class="nx">reversible</span><span class="o">:</span> <span class="kc">true</span>
          
              <span class="c1">// 好了, 这里具体定义效果是什么. ParallelAnimation是说同时进行若干效果</span>
              <span class="nx">ParallelAnimation</span> <span class="p">{</span>
                  <span class="c1">// 转换方向</span>
                  <span class="nx">NumberAnimation</span> <span class="p">{</span> <span class="nx">properties</span><span class="o">:</span> <span class="s2">&quot;y,rotation&quot;</span><span class="p">;</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">InOutQuad</span> <span class="p">}</span>
          
                  <span class="c1">// 变色</span>
                  <span class="nx">ColorAnimation</span> <span class="p">{</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
              <span class="p">}</span>
          <span class="p">}</span>
          </pre></div>
          <p>通过这样定义的方式来写GUI, 是不是很清晰明了?</p>
          </div>
          <div class="section" id="id6">
          <h1>结论</h1>
          <p>我原先接触过WPF, 也是定义的方式来做的, 现在看到Qt也支持了, 感到蛮欣慰的. 我现在使用pyqt, 听说pyside的snapshot里面已经支持qml了, 期待稳定版本的发布.</p>
          <p>看到网站上面有对应的截图, 个人猜测他们会把QML的内容整合到web上面. QML是支持javascript的, 具体内容可在 <a class="reference external" href="http://doc.qt.nokia.com/4.7-snapshot/qml-advtutorial.html">深入教程</a> 里面, 可以看看.</p>
          </div>
          </div>
        </div>
        <div class='time-stamp'>
          <p>建立时间: 2010/11/24 21:35:00</p>
          <p>更新时间: 2010/11/25 13:35:00</p>
        </div>
        <div id='comments'>
          <div id='disqus_thread'>
            <script type="text/javascript">
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://halidasvps.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=halidasvps">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
            <script type="text/javascript">
            var disqus_shortname = 'halidasvps';
            (function () {
            var s = document.createElement('script'); s.async = true;
            s.src = 'http://disqus.com/forums/halidasvps/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
            }());
            </script>
          </div>
        </div>
      </div>
      <footer>
        <p>
          @2011 linjunhalida, all right reserved,
          source code <a href="https://github.com/halida/haliblog" target="_blank">here</a>.
        </p>
      </footer>
    </div>
    <div id='return-top-block'>
      <div id='return-top-inner'>
        <a id='return-top' onclick="javascript: $('html,body').animate({scrollTop: 0}, 400);">===></a>
      </div>
    </div>
    <script src="/javascripts/jquery.pjax.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.appear-1.1.1.min.js" type="text/javascript"></script>
    <script src="/javascripts/main.js" type="text/javascript"></script>
    <script src="/javascripts/vim.js" type="text/javascript"></script>
    <script type='text/javascript'>
      //<![CDATA[
        (function() {
    
      $(function() {
        init();
        return init_vim_key('#content');
      });
    
    }).call(this);
    
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-26509244-1']);
        _gaq.push(['_trackPageview', '_trackPageLoadTime']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
  </body>
</html>
